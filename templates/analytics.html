{% include '_page_start.html' %}

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="flashes">
      {% for message in messages %}
        <li><span>{{ message }}</span><button class="flash-close" type="button" aria-label="Close">&times;</button></li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% include '_employee_header.html' %}

<h1>Analytics</h1>

<h2>Most Prolific Customers ({{ customer_range_label }})</h2>
<div class="range-toggle mb-3" role="group" aria-label="Customer analytics range">
  <a class="btn btn-outline-primary {% if current_customer_range == 'month' %}active{% endif %}" href="{{ url_for('analytics', customer_range='month', delivery_range=current_delivery_range) }}">Past Month</a>
  <a class="btn btn-outline-primary {% if current_customer_range == '6months' %}active{% endif %}" href="{{ url_for('analytics', customer_range='6months', delivery_range=current_delivery_range) }}">Past 6 Months</a>
  <a class="btn btn-outline-primary {% if current_customer_range == 'all' %}active{% endif %}" href="{{ url_for('analytics', customer_range='all', delivery_range=current_delivery_range) }}">All Time</a>
</div>
<h3>By Number of Orders</h3>
{% if prolific_by_orders %}
  <p><strong>{{ prolific_by_orders.name }}</strong> ({{ prolific_by_orders.email }})</p>
  <p>Orders: {{ prolific_by_orders.count }}</p>
{% else %}
  <p>No orders yet.</p>
{% endif %}

<h3>By Total Spend</h3>
{% if prolific_by_spend %}
  <p><strong>{{ prolific_by_spend.name }}</strong> ({{ prolific_by_spend.email }})</p>
  <p>Total spent: {{ "{:,.2f} lei".format(prolific_by_spend.total) }}</p>
{% else %}
  <p>No order revenue yet.</p>
{% endif %}

<h2>Most Prolific Delivery Company ({{ delivery_range_label }})</h2>
<div class="range-toggle mb-3" role="group" aria-label="Delivery analytics range">
  <a class="btn btn-outline-primary {% if current_delivery_range == 'month' %}active{% endif %}" href="{{ url_for('analytics', customer_range=current_customer_range, delivery_range='month') }}">Past Month</a>
  <a class="btn btn-outline-primary {% if current_delivery_range == '6months' %}active{% endif %}" href="{{ url_for('analytics', customer_range=current_customer_range, delivery_range='6months') }}">Past 6 Months</a>
  <a class="btn btn-outline-primary {% if current_delivery_range == 'all' %}active{% endif %}" href="{{ url_for('analytics', customer_range=current_customer_range, delivery_range='all') }}">All Time</a>
</div>
{% if prolific_distributor %}
  <p><strong>{{ prolific_distributor.name }}</strong></p>
  <p>Deliveries: {{ prolific_distributor.count }}</p>
{% else %}
  <p>No deliveries yet.</p>
{% endif %}

<h3>By Delivered Quantity</h3>
{% if prolific_distributor_qty %}
  <p><strong>{{ prolific_distributor_qty.name }}</strong></p>
  <p>Quantity: {{ prolific_distributor_qty.quantity }}</p>
{% else %}
  <p>No deliveries yet.</p>
{% endif %}

<h2>Top 5 Products by Revenue</h2>
{% if top_products %}
  <table class="table table-striped table-hover">
    <tr>
      <th>Product</th>
      <th>Revenue</th>
    </tr>
    {% for product in top_products %}
    <tr>
      <td>{{ product.name }}</td>
      <td>{{ "{:,.2f} lei".format(product.revenue) }}</td>
    </tr>
    {% endfor %}
  </table>
{% else %}
  <p>No product revenue yet.</p>
{% endif %}

{% include '_page_end.html' %}


