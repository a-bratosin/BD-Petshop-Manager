
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="flashes">
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form action="/create-product" method="POST" enctype="multipart/form-data">
    <div>
        <label for="CategorieId">Category:</label>
        <select name="CategorieId" id="CategorieId" required>
            <option value="">Select a category</option>
            {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="SubcategorieId">Subcategory:</label>
        <select name="SubcategorieId" id="SubcategorieId" required>
            <option value="">Select a subcategory</option>
            {% for subcategory in subcategories %}
                <option value="{{ subcategory.id }}" data-category="{{ subcategory.categorie_id }}">{{ subcategory.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="Imagine">Product Image:</label>
        <input type="file" name="Imagine" id="Imagine" accept="image/*">
    </div>

    <div>
        <label for="Stoc">Stock (Stoc):</label>
        <input type="number" name="Stoc" id="Stoc" required>
    </div>

    <div>
        <label for="Pret">Price (Pret):</label>
        <input type="number" name="Pret" id="Pret" step="0.01" required>
    </div>

    <div>
        <label for="Cost">Cost (Cost):</label>
        <input type="number" name="Cost" id="Cost" step="0.01" required>
    </div>

    <div>
        <label for="Descriere">Description:</label>
        <textarea name="Descriere" id="Descriere" maxlength="200" required></textarea>
    </div>

    <button type="submit">Create Product</button>
</form>

<script>
// Filter subcategories based on selected category
document.addEventListener('DOMContentLoaded', function() {
    const categorySelect = document.getElementById('CategorieId');
    const subcategorySelect = document.getElementById('SubcategorieId');
    const allOptions = Array.from(subcategorySelect.options);

    categorySelect.addEventListener('change', function() {
        const selectedCategory = this.value;
        subcategorySelect.innerHTML = '';
        // Add default option
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = 'Select a subcategory';
        subcategorySelect.appendChild(defaultOption);
        // Add only matching subcategories
        allOptions.forEach(function(option) {
            if (!option.value) return; // skip default
            if (option.getAttribute('data-category') === selectedCategory) {
                subcategorySelect.appendChild(option.cloneNode(true));
            }
        });
    });
});
</script>